import{_ as A,r as o,p as I,q as M,s as N,c as p,a as e,t as n,b as V,T as z,C as F,l as U,m as B,F as H,d as P,x as y,o as f,u as j,y as q,j as G}from"./index-PDS2Q5JA.js";const J={class:"error-monitor"},K={class:"page-header"},Q={class:"header-stats"},W={class:"stat-item"},X={class:"stat-value"},Y={class:"stat-item"},Z={class:"stat-value"},ee={class:"stat-item"},te={class:"stat-value"},ae={class:"chart-section"},se={class:"chart-card"},re={class:"chart-section"},oe={class:"chart-card"},ne={class:"chart-header"},le={class:"chart-actions"},ie={class:"error-list"},ce={class:"error-message"},de=["onClick"],ue={__name:"ErrorMonitor",setup(pe){const g=o(156),b=o(.15),_=o(.12),x=o(89),S=o(.25),v=(r,t)=>Array.from({length:24},(a,s)=>{const C=s>=9&&s<=18?1.5:.5;return Math.floor((r+Math.random()*t)*C)}),w=v(8,5),k=v(7,4),E=o([{id:1,message:"Cannot read property 'data' of undefined",type:"TypeError",path:"/products/detail",browser:"Chrome 120.0.0",count:23,lastOccurred:new Date().toISOString()},{id:2,message:"Failed to fetch API endpoint",type:"NetworkError",path:"/api/users",browser:"Firefox 121.0",count:15,lastOccurred:new Date(Date.now()-3e5).toISOString()},{id:3,message:"Unexpected token in JSON",type:"SyntaxError",path:"/checkout",browser:"Safari 17.0",count:8,lastOccurred:new Date(Date.now()-9e5).toISOString()}]),d=o(null),u=o(null);let l=null,i=null;const c=o("page"),D=[{name:"/products/detail",value:156,percent:28},{name:"/checkout",value:89,percent:16},{name:"/user/profile",value:67,percent:12},{name:"/cart",value:45,percent:8},{name:"/order/confirm",value:34,percent:6}],L=[{name:"TypeError",value:234,percent:32},{name:"NetworkError",value:156,percent:21},{name:"SyntaxError",value:98,percent:13},{name:"ReferenceError",value:67,percent:9},{name:"RangeError",value:45,percent:6}],O=()=>{if(!d.value)return;l=y(d.value);const r=Array.from({length:24},(a,s)=>`${s}:00`),t={tooltip:{trigger:"axis",formatter:function(a){return`${a[0].axisValue}<br/>
          今日: ${a[0].value} 次<br/>
          昨日: ${a[1].value} 次`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:r,axisLabel:{formatter:"{value}"}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed"}}},series:[{name:"今日",type:"line",data:w,smooth:!0,showSymbol:!1,itemStyle:{color:"#ff4d4f"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255,77,79,0.3)"},{offset:1,color:"rgba(255,77,79,0.1)"}]}}},{name:"昨日",type:"line",data:k,smooth:!0,showSymbol:!1,itemStyle:{color:"#52c41a"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(82,196,26,0.3)"},{offset:1,color:"rgba(82,196,26,0.1)"}]}}}]};l.setOption(t)},R=r=>{$.push(`/monitor/error/${r.id}`)},m=()=>{l==null||l.resize()},T=()=>{u.value&&(i=y(u.value),h())},h=()=>{const r=c.value==="page"?D:L,t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){const s=a[0].data;return`${s.name}<br/>
          错误数: ${s.value}<br/>
          占比: ${s.percent}%`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",splitLine:{lineStyle:{type:"dashed"}}},yAxis:{type:"category",data:r.map(a=>a.name),axisLabel:{formatter:function(a){return a.length>15?a.slice(0,15)+"...":a}}},series:[{name:"错误数",type:"bar",data:r,itemStyle:{color:function(a){return["#ffccc7","#ffa39e","#ff7875","#ff4d4f","#f5222d"][a.dataIndex]}},label:{show:!0,position:"right",formatter:"{c} 次"}}]};i.setOption(t)};I(c,()=>{h()});const $=G();return M(()=>{O(),T(),window.addEventListener("resize",m)}),N(()=>{window.removeEventListener("resize",m),l==null||l.dispose(),i==null||i.dispose()}),(r,t)=>(f(),p("div",J,[e("div",K,[t[4]||(t[4]=e("h2",null,"错误监控",-1)),e("div",Q,[e("div",W,[t[1]||(t[1]=e("span",{class:"stat-label"},"今日错误",-1)),e("span",X,n(g.value),1),V(z,{value:b.value,"previous-value":_.value,format:"percentage"},null,8,["value","previous-value"])]),e("div",Y,[t[2]||(t[2]=e("span",{class:"stat-label"},"影响用户",-1)),e("span",Z,n(x.value),1)]),e("div",ee,[t[3]||(t[3]=e("span",{class:"stat-label"},"错误率",-1)),e("span",te,n(S.value)+"%",1)])])]),e("div",ae,[e("div",se,[t[5]||(t[5]=F('<div class="chart-header" data-v-4f43ab6e><h3 data-v-4f43ab6e>错误趋势对比</h3><div class="legend" data-v-4f43ab6e><span class="legend-item" data-v-4f43ab6e><span class="legend-color" style="background:#ff4d4f;" data-v-4f43ab6e></span> 今日 </span><span class="legend-item" data-v-4f43ab6e><span class="legend-color" style="background:#52c41a;" data-v-4f43ab6e></span> 昨日 </span></div></div>',1)),e("div",{ref_key:"trendChartRef",ref:d,class:"chart-container"},null,512)])]),e("div",re,[e("div",oe,[e("div",ne,[t[7]||(t[7]=e("h3",null,"错误排行 TOP 5",-1)),e("div",le,[U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),class:"ranking-select"},t[6]||(t[6]=[e("option",{value:"page"},"按页面",-1),e("option",{value:"error"},"按错误类型",-1)]),512),[[B,c.value]])])]),e("div",{ref_key:"rankingChartRef",ref:u,class:"chart-container ranking-chart"},null,512)])]),e("div",ie,[t[9]||(t[9]=e("h3",null,"最近错误",-1)),e("table",null,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"错误信息"),e("th",null,"错误类型"),e("th",null,"页面路径"),e("th",null,"浏览器"),e("th",null,"发生次数"),e("th",null,"最近发生"),e("th",null,"操作")])],-1)),e("tbody",null,[(f(!0),p(H,null,P(E.value,a=>(f(),p("tr",{key:a.id},[e("td",ce,n(a.message),1),e("td",null,n(a.type),1),e("td",null,n(a.path),1),e("td",null,n(a.browser),1),e("td",null,n(a.count),1),e("td",null,n(j(q)(a.lastOccurred,"HH:mm:ss")),1),e("td",null,[e("button",{class:"action-btn",onClick:s=>R(a)},"详情",8,de)])]))),128))])])])]))}},ve=A(ue,[["__scopeId","data-v-4f43ab6e"]]);export{ve as default};
