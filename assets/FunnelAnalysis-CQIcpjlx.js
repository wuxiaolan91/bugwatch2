import{_ as L,r as d,k as C,q as V,s as M,c as A,a as s,t as c,u as p,n as _,b as E,T as I,x as z,y as m,z as v,L as N,h as b,o as B}from"./index-CRI02doo.js";const F={class:"funnel-analysis"},P={class:"page-header"},T={class:"header-left"},G={class:"date-range"},O={class:"header-right"},U={class:"analysis-content"},W={class:"overview-card"},q={class:"overview-stats"},j={class:"stat-item"},H={class:"stat-value"},J={class:"stat-item"},K={class:"stat-value"},Q={class:"stat-item"},X={class:"stat-value"},Y={class:"funnel-visualization"},Z={class:"trend-chart"},ee={__name:"FunnelAnalysis",setup(te){const a=d({id:1,name:"注册转化漏斗",overallRate:.23,previousRate:.21,totalVisitors:25678,completions:5906,steps:[{name:"访问注册页",users:25678,conversionRate:1,trend:[100,98,95,97,99,96,98]},{name:"开始注册",users:18234,conversionRate:.71,trend:[75,70,72,68,71,69,71]},{name:"填写表单",users:12445,conversionRate:.48,trend:[52,48,50,45,47,46,48]},{name:"验证邮箱",users:8876,conversionRate:.35,trend:[38,35,36,33,34,35,35]},{name:"完成注册",users:5906,conversionRate:.23,trend:[25,23,24,21,22,23,23]}]}),r=d(7),x=d(new Date),w=C(()=>{const n=new Date(x.value);return n.setDate(n.getDate()-r.value),n}),h=n=>{r.value=n},f=n=>{const e=["#1890ff","#52c41a","#faad14","#722ed1","#eb2f96"];return e[n%e.length]},y=d(null),g=d(null);let l=null,i=null;const D=()=>{if(!y.value)return;l=z(y.value);const n=R(),e={title:{text:"各步骤转化率趋势",subtext:"最近7天每个步骤的转化率变化",left:"center",top:10,textStyle:{fontSize:16,fontWeight:"normal"},subtextStyle:{fontSize:12}},tooltip:{trigger:"axis",formatter:function(t){let o=`${m(t[0].axisValue,"MM-DD")}<br/>`;return t.forEach(u=>{const k=`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${u.color};"></span>`;o+=`${k}${u.seriesName}: ${v(u.value/100)}<br/>`}),o}},legend:{show:!0,top:60,type:"scroll",textStyle:{fontSize:12},selected:a.value.steps.reduce((t,o)=>(t[o.name]=o.name===a.value.steps[0].name||o.name===a.value.steps[a.value.steps.length-1].name,t),{})},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,top:120},xAxis:{type:"category",boundaryGap:!1,data:n,axisLabel:{formatter:t=>m(t,"MM-DD"),fontSize:12}},yAxis:{type:"value",axisLabel:{formatter:t=>v(t/100),fontSize:12},max:100,splitLine:{lineStyle:{type:"dashed",opacity:.3}}},series:a.value.steps.map((t,o)=>({name:t.name,type:"line",smooth:!0,data:t.trend,symbolSize:6,lineStyle:{width:2},itemStyle:{color:f(o)},areaStyle:{opacity:.1,color:new N(0,0,0,1,[{offset:0,color:f(o)},{offset:1,color:`${f(o)}00`}])}}))};l.setOption(e)},$=()=>{if(!g.value)return;i=z(g.value);const n={tooltip:{trigger:"item",formatter:function(e){const t=e.dataIndex<a.value.steps.length-1?a.value.steps[e.dataIndex+1].users:null,o=t?e.value-t:0,u=t?v(1-t/e.value):"-";return`${e.name}<br/>
                用户数: ${b(e.value)}<br/>
                转化率: ${v(e.value/a.value.steps[0].users)}<br/>
                流失: ${t?b(o):"-"} (${u})`}},series:[{name:"漏斗转化",type:"funnel",left:"10%",top:60,bottom:60,width:"80%",min:0,max:a.value.steps[0].users,minSize:"0%",maxSize:"100%",sort:"none",gap:2,label:{show:!0,position:"right",formatter:e=>`${e.name}
${v(e.value/a.value.steps[0].users)}`},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{fontSize:14}},data:a.value.steps.map((e,t)=>({value:e.users,name:e.name,itemStyle:{color:f(t)}}))}]};i.setOption(n)},R=()=>{const n=[];for(let e=6;e>=0;e--){const t=new Date;t.setDate(t.getDate()-e),n.push(t)}return n},S=()=>{l==null||l.resize(),i==null||i.resize()};return V(()=>{D(),$(),window.addEventListener("resize",S)}),M(()=>{window.removeEventListener("resize",S),l==null||l.dispose(),i==null||i.dispose()}),(n,e)=>(B(),A("div",F,[s("div",P,[s("div",T,[s("h2",null,c(a.value.name),1),s("span",G,c(p(m)(w.value))+" - "+c(p(m)(x.value)),1)]),s("div",O,[s("button",{class:_(["date-btn",{active:r.value===7}]),onClick:e[0]||(e[0]=t=>h(7))}," 近7天 ",2),s("button",{class:_(["date-btn",{active:r.value===14}]),onClick:e[1]||(e[1]=t=>h(14))}," 近14天 ",2),s("button",{class:_(["date-btn",{active:r.value===30}]),onClick:e[2]||(e[2]=t=>h(30))}," 近30天 ",2)])]),s("div",U,[s("div",W,[e[6]||(e[6]=s("h3",null,"转化概览",-1)),s("div",q,[s("div",j,[e[3]||(e[3]=s("div",{class:"stat-label"},"总体转化率",-1)),s("div",H,[E(I,{value:a.value.overallRate,"previous-value":a.value.previousRate,format:"percentage"},null,8,["value","previous-value"])])]),s("div",J,[e[4]||(e[4]=s("div",{class:"stat-label"},"访问人数",-1)),s("div",K,c(p(b)(a.value.totalVisitors)),1)]),s("div",Q,[e[5]||(e[5]=s("div",{class:"stat-label"},"完成人数",-1)),s("div",X,c(p(b)(a.value.completions)),1)])])]),s("div",Y,[e[7]||(e[7]=s("h3",null,"漏斗可视化",-1)),s("div",{ref_key:"funnelChartRef",ref:g,class:"chart-container"},null,512)]),s("div",Z,[e[8]||(e[8]=s("h3",null,"转化趋势",-1)),s("div",{ref_key:"trendChartRef",ref:y,class:"chart-container"},null,512)])])]))}},ne=L(ee,[["__scopeId","data-v-fdd1db15"]]);export{ne as default};
